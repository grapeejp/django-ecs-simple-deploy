2025-05-28 17:41:58,430 - INFO - 🚀 AWS Bedrock Claude 4 包括的テスト開始
2025-05-28 17:41:58,430 - INFO - ============================================================
2025-05-28 17:41:58,430 - INFO - 🔑 AWS認証情報テスト開始
2025-05-28 17:41:58,438 - INFO - Found credentials in environment variables.
2025-05-28 17:42:00,980 - INFO - ✅ AWS認証情報: 正常
2025-05-28 17:42:00,980 - INFO -    - Account ID: 026090540679
2025-05-28 17:42:00,980 - INFO -    - User ID: AIDAQMEY6B2DQ5HVGABL5
2025-05-28 17:42:00,980 - INFO -    - ARN: arn:aws:iam::026090540679:user/yasutoshi.yanagimoto
2025-05-28 17:42:00,980 - INFO -    - Region: ap-northeast-1
2025-05-28 17:42:00,981 - INFO - 🔧 Bedrockサービスアクセステスト開始
2025-05-28 17:42:00,991 - INFO - ✅ Bedrockクライアント作成: 成功
2025-05-28 17:42:01,744 - INFO - ✅ Foundation Models取得: 成功 (30モデル)
2025-05-28 17:42:01,744 - INFO - 🤖 Claude関連モデル数: 16
2025-05-28 17:42:01,744 - INFO -    - anthropic.claude-instant-v1:2:18k (Claude Instant)
2025-05-28 17:42:01,744 - INFO -    - anthropic.claude-instant-v1 (Claude Instant)
2025-05-28 17:42:01,744 - INFO -    - anthropic.claude-v2:1:18k (Claude)
2025-05-28 17:42:01,744 - INFO -    - anthropic.claude-v2:1:200k (Claude)
2025-05-28 17:42:01,744 - INFO -    - anthropic.claude-v2:1 (Claude)
2025-05-28 17:42:01,744 - INFO -    - anthropic.claude-3-haiku-20240307-v1:0 (Claude 3 Haiku)
2025-05-28 17:42:01,744 - INFO -    - anthropic.claude-3-5-sonnet-20240620-v1:0 (Claude 3.5 Sonnet)
2025-05-28 17:42:01,744 - INFO -    - anthropic.claude-3-sonnet-20240229-v1:0:28k (Claude 3 Sonnet)
2025-05-28 17:42:01,744 - INFO -    - anthropic.claude-3-sonnet-20240229-v1:0:200k (Claude 3 Sonnet)
2025-05-28 17:42:01,745 - INFO -    - anthropic.claude-3-sonnet-20240229-v1:0 (Claude 3 Sonnet)
2025-05-28 17:42:01,745 - INFO - 🚀 全Claudeモデルアクセステスト開始
2025-05-28 17:42:01,745 - INFO - 🎯 モデルアクセステスト: apac.anthropic.claude-sonnet-4-20250514-v1:0
2025-05-28 17:42:03,058 - ERROR - ❌ apac.anthropic.claude-sonnet-4-20250514-v1:0: アクセス失敗
2025-05-28 17:42:03,058 - ERROR -    - エラー: An error occurred (AccessDeniedException) when calling the InvokeModel operation: You don't have access to the model with the specified model ID.
2025-05-28 17:42:03,058 - ERROR -    - 原因: アクセス権限不足
2025-05-28 17:42:03,058 - ERROR -    - 対策: IAMポリシーでbedrock:InvokeModelの権限を追加
2025-05-28 17:42:03,058 - INFO - 🎯 モデルアクセステスト: anthropic.claude-3-5-sonnet-20241022-v2:0
2025-05-28 17:42:03,303 - ERROR - ❌ anthropic.claude-3-5-sonnet-20241022-v2:0: アクセス失敗
2025-05-28 17:42:03,303 - ERROR -    - エラー: An error occurred (ValidationException) when calling the InvokeModel operation: Invocation of model ID anthropic.claude-3-5-sonnet-20241022-v2:0 with on-demand throughput isn’t supported. Retry your request with the ID or ARN of an inference profile that contains this model.
2025-05-28 17:42:03,303 - ERROR -    - 原因: リクエスト形式またはモデルID不正
2025-05-28 17:42:03,303 - ERROR -    - 対策: モデルIDとペイロード形式を確認
2025-05-28 17:42:03,303 - INFO - 🎯 モデルアクセステスト: anthropic.claude-3-5-sonnet-20240620-v1:0
2025-05-28 17:42:04,024 - INFO - ✅ anthropic.claude-3-5-sonnet-20240620-v1:0: アクセス成功
2025-05-28 17:42:04,024 - INFO -    - 応答時間: 0.72秒
2025-05-28 17:42:04,024 - INFO -    - テスト応答: はい。...
2025-05-28 17:42:04,025 - INFO - 🎯 モデルアクセステスト: anthropic.claude-3-sonnet-20240229-v1:0
2025-05-28 17:42:04,249 - ERROR - ❌ anthropic.claude-3-sonnet-20240229-v1:0: アクセス失敗
2025-05-28 17:42:04,249 - ERROR -    - エラー: An error occurred (ValidationException) when calling the InvokeModel operation: Invocation of model ID anthropic.claude-3-sonnet-20240229-v1:0 with on-demand throughput isn’t supported. Retry your request with the ID or ARN of an inference profile that contains this model.
2025-05-28 17:42:04,249 - ERROR -    - 原因: リクエスト形式またはモデルID不正
2025-05-28 17:42:04,249 - ERROR -    - 対策: モデルIDとペイロード形式を確認
2025-05-28 17:42:04,249 - INFO - 📊 テスト結果サマリー:
2025-05-28 17:42:04,249 - INFO -    - テスト対象: 4モデル
2025-05-28 17:42:04,250 - INFO -    - アクセス可能: 1モデル
2025-05-28 17:42:04,250 - INFO -    - アクセス不可: 3モデル
2025-05-28 17:42:04,250 - INFO - ✅ アクセス可能なモデル:
2025-05-28 17:42:04,250 - INFO -    - anthropic.claude-3-5-sonnet-20240620-v1:0 (応答時間: 0.72秒)
2025-05-28 17:42:04,250 - INFO - 🔐 IAM権限確認開始
2025-05-28 17:42:04,638 - INFO - ✅ bedrock:ListFoundationModels: 権限あり
2025-05-28 17:42:04,942 - WARNING - ⚠️ bedrock-runtime:InvokeModel: 権限なし - An error occurred (ValidationException) when calling the InvokeModel operation: Invocation of model ID anthropic.claude-3-sonnet-20240229-v1:0 with on-demand throughput isn’t supported. Retry your request with the ID or ARN of an inference profile that contains this model.
2025-05-28 17:42:04,942 - INFO - 📋 IAMポリシー推奨事項生成
2025-05-28 17:42:04,943 - INFO - 📄 推奨IAMポリシー:
2025-05-28 17:42:04,943 - INFO - {
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "bedrock:ListFoundationModels",
        "bedrock:GetFoundationModel",
        "bedrock:InvokeModel"
      ],
      "Resource": "*"
    },
    {
      "Effect": "Allow",
      "Action": [
        "bedrock-runtime:InvokeModel",
        "bedrock-runtime:InvokeModelWithResponseStream"
      ],
      "Resource": [
        "arn:aws:bedrock:ap-northeast-1::foundation-model/apac.anthropic.claude-sonnet-4-20250514-v1:0",
        "arn:aws:bedrock:ap-northeast-1::foundation-model/anthropic.claude-3-5-sonnet-20241022-v2:0",
        "arn:aws:bedrock:ap-northeast-1::foundation-model/anthropic.claude-3-5-sonnet-20240620-v1:0",
        "arn:aws:bedrock:ap-northeast-1::foundation-model/anthropic.claude-3-sonnet-20240229-v1:0"
      ]
    }
  ]
}
2025-05-28 17:42:04,944 - INFO - 💾 推奨ポリシーをrecommended_bedrock_policy.jsonに保存しました
2025-05-28 17:42:04,944 - INFO - ============================================================
2025-05-28 17:42:04,944 - INFO - 📊 最終テスト結果サマリー
2025-05-28 17:42:04,944 - INFO - ============================================================
2025-05-28 17:42:04,945 - INFO - AWS認証情報: ✅ 正常
2025-05-28 17:42:04,945 - INFO - Bedrockサービス: ✅ 正常
2025-05-28 17:42:04,945 - INFO - アクセス可能モデル数: 1/4
2025-05-28 17:42:04,945 - INFO - 
📋 推奨事項:
2025-05-28 17:42:04,945 - INFO -    ✅ 利用可能なモデルが見つかりました
2025-05-28 17:42:04,945 - INFO -    🎯 推奨モデル: anthropic.claude-3-5-sonnet-20240620-v1:0 (応答時間: 0.72秒)
