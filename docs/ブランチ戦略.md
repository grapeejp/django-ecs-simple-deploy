# ブランチ戦略

本プロジェクトでは、GitHubフローをベースにしたシンプルなブランチ戦略を採用します。

## ブランチ構成

- `main`: 常にデプロイ可能な状態を維持するプロダクションブランチ
- 機能ブランチ：新機能開発やバグ修正用の一時的なブランチ

## ブランチ命名規則

機能ブランチは以下の命名規則に従って作成します：

- 機能追加: `feature/機能名`
- バグ修正: `fix/問題名`
- リファクタリング: `refactor/対象名`
- ドキュメント: `docs/内容`
- 緊急修正: `hotfix/問題名`

例:
```
feature/django-health-check
fix/cors-issue
refactor/docker-multi-stage
docs/deployment-guide
hotfix/security-vulnerability
```

## 開発フロー

### 1. 新機能開発 / バグ修正

1. `main`ブランチから新しい機能ブランチを作成
   ```bash
   git checkout main
   git pull
   git checkout -b feature/新機能
   ```

2. 機能ブランチで開発を実施
   - 適切な単位でコミットを作成
   - コミットメッセージは具体的かつ明確に記述

3. 開発完了後、GitHub上でプルリクエストを作成
   - プルリクエストのタイトルと説明には変更内容を明確に記述
   - レビュアーをアサイン

4. コードレビュー実施
   - 少なくとも1名のレビュアーによる承認が必要

5. プルリクエストがレビューされ承認されたら`main`ブランチにマージ
   - マージは「Squash and merge」または「Rebase and merge」を推奨

### 2. デプロイ

1. `main`ブランチへのマージ後、自動的にデプロイパイプラインが実行される
   - CI/CDパイプラインで自動テストが実行される
   - テスト成功後、ステージング環境に自動デプロイ

2. ステージング環境での検証
   - 手動テストや自動化されたE2Eテストでの検証

3. 本番環境へのデプロイ
   - 手動承認または特定のタグ付けにより本番デプロイを実行

### 3. 緊急修正（Hotfix）

1. `main`ブランチから直接`hotfix`ブランチを作成
   ```bash
   git checkout main
   git pull
   git checkout -b hotfix/緊急問題
   ```

2. 修正を実施してプルリクエスト作成
   - 緊急度に応じて簡略化されたレビュープロセスを適用可能

3. マージ後すぐにデプロイ
   - 本番環境への影響範囲を最小限に抑えた修正を心がける

## プルリクエストのルール

1. **説明**: 変更内容と目的を明確に記述
2. **サイズ**: 可能な限り小さな変更単位に分割する
3. **テスト**: 自動テストが成功していることを確認
4. **レビュー**: 少なくとも1名のレビュアーによる承認が必要
5. **ブランチ保護**: `main`ブランチへの直接プッシュは禁止

## マージ後のクリーンアップ

マージされたブランチは、以下の手順でクリーンアップを行います：

```bash
# リモートブランチの最新情報を取得
git fetch --prune

# ローカルのマージ済みブランチを削除
git branch --merged | grep -v "\*" | grep -v "main" | xargs -n 1 git branch -d

# リモートのブランチを確認
git branch -r
``` 