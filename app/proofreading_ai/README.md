## 校正AIロジック設計詳細（参考: FastAPI版 app.py/view_dev.html）

### 基本思想
- 校正AIの校正結果（ハイライトやツールチップ含むHTML）は**サーバー側で生成**し、フロントエンドは**innerHTMLでそのまま表示**する。
- JS側でエスケープやハイライト処理は行わず、サーバーから返されたHTMLをそのまま描画する。
- 校正辞書やパラメータもサーバー側で管理。

### 処理フロー
1. クライアント（JS）は入力テキスト・パラメータをAPI（WebSocket/HTTP）に送信
2. サーバー側でAI（Claude等）＋校正辞書で校正を実行
3. 校正結果（correctionsリスト）をもとに、
    - 元テキストの該当箇所を`<span class="correction-span">...</span>`等でラップし、
    - ツールチップや修正案ボタンもHTMLで組み立てる
4. サーバーは**ハイライト付きHTML文字列**を返す
5. フロントは`correctionResult.innerHTML = ...`でそのまま表示
6. ハイライト部分のクリックイベントや修正案選択のみJSで制御

### 主要関数の役割
- `format_corrections(original_text, corrections)`
    - 元テキストとcorrectionsリストから、ハイライト付きHTMLを生成
    - 例: 元文の該当箇所を`<span class="correction-span">...</span>`でラップし、ツールチップや修正案ボタンもHTMLで埋め込む
- 校正辞書の管理・適用もサーバー側で行う

### メリット
- タグやエスケープの混乱を防げる
- フロントのロジックがシンプルになる
- サーバー側で校正ロジックを一元管理できる

---
Django側でもこの設計思想を踏襲し、校正結果HTMLをサーバーで生成・返却する形にリファクタリングすること。 